{{extend 'layout_new.html'}}
{{block head}}
   <style>
       h1,h3{
           font-family:Copperplate;
       }
       body{
           background-color:light grey;
           color:red;
           font-family:Courier New; font-size:15px;
       }
    </style> 
{{end}}

<h1><em>Add Customer/Company</em></h1>
<h3><em>Customer Form</em></h3>
{{=customer_form}}
{{=company_form}}
<br><br>


{{block page_js}}
<script>
    //change the field name of Co Id 
    document.getElementById("persons_co_id__label").innerHTML = "Company Name";
    //change the label name of work phone num
    document.getElementById("persons_work_phone_num__label").innerHTML = "Work Phone Number";

    let divCompany = document.createElement("div");
    divCompany.setAttribute("id", "divCompany");
    let divPlacement = document.getElementById("persons_co_id__row");
    divPlacement.appendChild(divCompany);
    let eleDivCompany = document.getElementById("divCompany");
    //create checkbox to expose company form
    let labelAddCompany = document.createElement("label");
    labelAddCompany.setAttribute("id", "labelAddCompany");
    labelAddCompany.setAttribute("for", "addCompany");
    labelAddCompany.innerHTML = 'Add Company:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="checkbox" name="addCompany" id="addCompany" onchange="exposeCompanyForm()">';
    eleDivCompany.appendChild(labelAddCompany);
    
    //sets the display for formCompany to 'none'
    let formCompany = document.forms[1];
    formCompany.setAttribute("id","formCompany");
    let eleFormCompany = document.getElementById("formCompany");
    //appends a div inside the formCompany
    let formCompanyHTML = formCompany.innerHTML;
    formCompany.innerHTML = `<div id='companyFormDiv'>${formCompanyHTML}</div>`;
    let newCompanyDiv = document.getElementById("companyFormDiv");
    newCompanyDiv.setAttribute("style","display:none");
    
    
    //repositions the form fields inside a new div below the checkbox 'addCompany'
    eleDivCompany.appendChild(newCompanyDiv);

    //sets the value of Employee Id to whoever is logged in and disables the field
    document.getElementById("persons_employee_id").setAttribute('readonly', 'True');
    document.getElementById("persons_employee_id").value = {{=str(session.auth.user.id)}};
    //sets the value of Created On Date to today's date
    let todayDate = new Date();
    theDay = todayDate.getDate();
    if (theDay <= 9){
        theDay = "0" + theDay;
    }
    theMonth = todayDate.getMonth() + 1;
    if (theMonth <= 9){
        theMonth = "0" + theMonth;
    }
    theYear = todayDate.getFullYear();
    document.getElementById("persons_created_on_date").value = `${theYear}-${theMonth}-${theDay}`;

    //sets the id for the customer form
    let formCustomer = document.forms[0];
    formCustomer.setAttribute("id", "formCustomer");
    //removes the submit button for the company form
    document.getElementById("submit_record__row").firstChild.firstChild.remove()



    //this exposes and hides the company form
    //changes the action of the customer form so that both forms can be processed
    function exposeCompanyForm(){
        if (document.getElementById("addCompany").checked){
            document.getElementById("persons_co_id").disabled = "True";
            formCustomer.setAttribute("action", "{{=URL('portal_sales_rep', 'submit_customer_and_company')}}");
        } else {
            document.getElementById("persons_co_id").removeAttribute("disabled");
            formCustomer.setAttribute("action", "#");
        }
        if (newCompanyDiv.getAttribute("style") == "display:none"){
            newCompanyDiv.setAttribute("style","display:block");  
        } else{
            newCompanyDiv.setAttribute("style", "display:none");
        }
    }
</script>
{{end page_js}}

